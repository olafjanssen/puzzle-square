var PlayableCard=(function(a){var e;a.subscribe(Messages.NEW_PLAYABLE_CARD,function(f){b(f)});a.subscribe(Messages.CARD_DROP_REFUSED,function(f){c()});function d(){return document.getElementById("stack")}function c(){setTimeout(function(){e.classList.add("animate-dnd");e.classList.remove("during-drag");e.style.top="";e.style.left=""},50)}function b(f){d().innerHTML="";e=f.render();d().appendChild(e);e.addEventListener("mousedown",function(i){var g=e.offsetLeft-i.clientX;var k=e.offsetTop-i.clientY;e.classList.remove("animate-dnd");e.classList.add("during-drag");var h=function(l){e.style.left=(g+l.clientX)+"px";e.style.top=(k+l.clientY)+"px"};var j=function(m){e.removeEventListener("mouseup",j);document.removeEventListener("mousemove",h);d().style.display="none";var l=document.elementFromPoint(m.clientX,m.clientY);d().style.display="";if(l!==null&&l.hasAttribute("ondrop")){a.publish(Messages.CARD_DROP_ATTEMPTED,{col:l.getAttribute("col"),row:l.getAttribute("row"),card:f})}else{c()}};document.addEventListener("mousemove",h,false);e.addEventListener("mouseup",j,false)},false);e.addEventListener("touchstart",function(h){var g=e.offsetLeft-h.changedTouches[0].pageX;var i=e.offsetTop-h.changedTouches[0].pageY;e.classList.remove("animate-dnd");e.classList.add("during-drag");e.addEventListener("touchmove",function(j){e.style.left=(g+j.changedTouches[0].pageX)+"px";e.style.top=(i+j.changedTouches[0].pageY)+"px"},false);e.addEventListener("touchend",function(k){d().style.display="none";var j=document.elementFromPoint(k.changedTouches[0].pageX,k.changedTouches[0].pageY);d().style.display="";if(j!==null&&j.hasAttribute("ondrop")){a.publish(Messages.CARD_DROP_ATTEMPTED,{col:j.getAttribute("col"),row:j.getAttribute("row"),card:f})}else{c()}},false)},false)}}(amplify));